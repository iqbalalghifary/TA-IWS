<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report</title>
    <!-- Include jsPDF library -->
    <script src="{{ url_for('static', filename='jsPDF-master/dist/jspdf.umd.min.js') }}"></script>
</head>
<body>
    <h1>Generate PDF using jsPDF</h1>
    <div id="message-container">
        {% for message in title_messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
    <button onclick="generatePDF()">Generate PDF</button>

    <!-- Add an iframe for PDF preview -->
    <iframe id="pdf-preview" width="100%" height="600px" style="border: 1px solid #ddd;"></iframe>

    <script>
        window.jsPDF = window.jspdf.jsPDF;

        // Declare doc as a global variable
        var doc;

        function setTextColor(result, passColor, failColor) {
            if (result === "PASS") {
                doc.setTextColor(passColor[0], passColor[1], passColor[2]);
            } else {
                doc.setTextColor(failColor[0], failColor[1], failColor[2]);
            }
        }

        function generatePDF() {
            // Create a new jsPDF instance
            doc = new jsPDF();
            doc.setFont('helvetica');
            var messageContainer = document.getElementById('message-container');

            var logoWidth = 50;
            var logoHeight = 30;
            var logoImage = '{{ url_for("static", filename="img/lemper-logo.png") }}';
            doc.addImage(logoImage, 'PNG', doc.internal.pageSize.width - logoWidth - 10, 5, logoWidth, logoHeight);

            var textLeft = 10;
            var textTop = 20;
            doc.setFontSize(12);
            doc.text('User  : {{ user_name }}', textLeft, textTop);
            doc.text('NIM   : {{ user_nim }}', textLeft, textTop + 5);

            var currentDate = new Date();
            var options = { 
                timeZone: 'Asia/Jakarta',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            };
            var formattedDate = currentDate.toLocaleDateString('en-US', options);
            doc.text('Date  : ' + formattedDate, textLeft, textTop + 10);

            doc.setFontSize(16);
            doc.text('Halaman Persetujuan', 10, 50);
            doc.line(10, 53, 200, 53);

            doc.setTextColor(255, 0, 0);
            doc.setFontSize(12);
            doc.text('Validity Report', 10, 60);

            doc.setTextColor(0, 0, 0);
            doc.line(10, 63, 200, 63);

            var word_count_result = "{{ word_count_result }}";
            var note = "{{ note }}";
            var status_nama_dosbing = "{{ status_nama_dosbing }}";
            var keterangan = "{{ keterangan }}";
            var status_nip_dosbing = "{{ status_nip_dosbing }}";
            var ket_nip_dosbing = "{{ ket_nip_dosbing }}";
            var status_kaprodi = "{{ status_kaprodi }}";
            var ket_status_kaprodi = "{{ ket_status_kaprodi }}";
            var status_nip_kaprodi = "{{ status_nip_kaprodi }}";
            var ket_status_nip_kaprodi = "{{ ket_status_nip_kaprodi }}";

            var passColor = [0, 128, 0];
            var failColor = [255, 0, 0];

            setTextColor(word_count_result, passColor, failColor);
            doc.text(word_count_result, doc.internal.pageSize.width - 20, 70, { align: 'right' });

            setTextColor(status_nama_dosbing, passColor, failColor);
            doc.text(status_nama_dosbing, doc.internal.pageSize.width - 20, 87, { align: 'right' });

            setTextColor(status_nip_dosbing, passColor, failColor);
            doc.text(status_nip_dosbing, doc.internal.pageSize.width - 20, 104, { align: 'right' });

            setTextColor(status_kaprodi, passColor, failColor);
            doc.text(status_kaprodi, doc.internal.pageSize.width - 20, 121, { align: 'right' });

            setTextColor(status_nip_kaprodi, passColor, failColor);
            doc.text(status_nip_kaprodi, doc.internal.pageSize.width - 20, 138, { align: 'right' });

            doc.setFontSize(10);
            doc.setFont('arial');
            doc.setTextColor(0, 0, 0);
            doc.text(note, 10, 75);
            doc.text(keterangan, 10, 92);
            doc.text(ket_nip_dosbing, 10, 109);
            doc.text(ket_status_kaprodi, 10, 126);
            doc.text(ket_status_nip_kaprodi, 10, 143);

            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.setFont('helvetica','bold');
            
            doc.text('JUDUL', 10, 70);
            doc.line(10, 80, 200, 80);

            doc.text('NAMA LENGKAP DAN GELAR PEMBIMBING JURUSAN', 10, 87);
            doc.line(10, 97, 200, 97);

            doc.text('NIP PEMBIMBING JURUSAN', 10, 104);
            doc.line(10, 114, 200, 114);

            doc.text('NAMA LENGKAP DAN GELAR KETUA PRODI', 10, 121);
            doc.line(10, 131, 200, 131);

            doc.text('NIP KETUA PRODI', 10, 138);
            doc.line(10, 148, 200, 148);

            // Replace the following code to set the src attribute of the iframe
            var pdfBlob = doc.output('blob');
            var pdfUrl = URL.createObjectURL(pdfBlob);

            var pdfPreview = document.getElementById('pdf-preview');
            pdfPreview.src = pdfUrl;  // Set the src attribute to the new PDF URL
        }
    </script>
</body>
</html>
